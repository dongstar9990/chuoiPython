using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Data.SqlClient;
namespace QuanLyTienNuoc
{
    public partial class frmDangNhap : Form
    {
        public frmDangNhap()
        {
            InitializeComponent();
        }

        private void frmDangNhap_Load(object sender, EventArgs e)
        {
           // this.Close();
        }

        private void btnDangNhap_Click(object sender, EventArgs e)
        {
            try
            {

                dangNhap();
            }
            catch (Exception)
            {
                MessageBox.Show("Kết nối thất bại! vui lòng kết nối lại", "Thông Báo", MessageBoxButtons.OK, MessageBoxIcon.Warning);
            }
            finally
            {
                kenoicosodulieu.DisConnection();
            }
                    
        }
        public SqlConnection getConnect()
        {
            return new SqlConnection(@"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\BTLQuanLySinhVien.mdf;Integrated Security=True");
        }
        public DataTable checkloge(string user, string pass)
        {
            string sql = "select * from DANGNHAP where TenDN ='" + user + "'and MK ='" + pass + "'";
            SqlConnection conn = getConnect();
            SqlDataAdapter ad = new SqlDataAdapter(sql, conn);
            DataTable dt = new DataTable();

            ad.Fill(dt);

            return dt;
        }
      

        private void bntThoat_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("Bạn có chắc chắn thoát không?", "Thông báo",
        MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
                Application.Exit();
        }

        private void frmDangNhap_MouseEnter(object sender, EventArgs e)
        {
          
        }

        private void txtMK_MouseEnter(object sender, EventArgs e)
        {
          
        }

        private void frmDangNhap_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (Convert.ToInt32(e.KeyChar) == 13)
            {
                dangNhap();
            }
        }

        private void dangNhap()
        {
            if (txtTenDangNha.Text == "" || txtMK.Text == "")
            {
               this.label3.ForeColor = Color.Red;
               this.label3.Text = "Chưa nhập tên đăng nhập hoặc mật khẩu!";
                         this.txtTenDangNha.Clear();
                         this.txtMK.Clear();
                         this.txtTenDangNha.Focus();
                
            }
            else
                if (txtTenDangNha.Text.Trim() != " " && txtMK.Text.Trim() != " ")
                {
                
                    frmMain MainChinh = new frmMain();
                    kenoicosodulieu.OpenConnection();
                    DataTable dt = new DataTable();
                    dt = kenoicosodulieu.getDataInTable("Select TenDN,MK From DANGNHAP");
                    string TenDN, MatKhau;
                   
                            TenDN = dt.Rows[0][0].ToString();
                            MatKhau = dt.Rows[0][1].ToString();
                            
                            if (TenDN == txtTenDangNha.Text && MatKhau == txtMK.Text)
                            {
                               
                                this.Hide();
                                MainChinh.ShowDialog();
                                Application.Exit();
                                
                                
                            }
                            else
                            {
                                this.label3.ForeColor = Color.Red;
                                this.label3.Text = "Nhập sai hoặc tài khoảng không tồn tại!";
                                this.txtTenDangNha.Clear();
                                this.txtMK.Clear();
                                this.txtTenDangNha.Focus();
                            }                       
                }         

        }

        private void checkBox1_CheckedChanged(object sender, EventArgs e)
        {
            if (checkBox1.Checked)
                txtMK.UseSystemPasswordChar = true;
            else
                txtMK.UseSystemPasswordChar = false;
        }

        private void button1_Click(object sender, EventArgs e)
        {
           
        }
    }
}
    

